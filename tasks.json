{
  "project": "ScholarAI - 全栈学术论文管理系统",
  "last_updated": "2025-02-13T12:00:00Z",
  "tech_stack": {
    "frontend": "React 18 + TypeScript + Vite 6 + Radix UI + Tailwind CSS",
    "backend": "Python Flask + MongoDB",
    "ai_service": "智谱AI API (知识库 + Agent API)"
  },
  "api_credentials": {
    "zhipu_api_key": "1c27785e91624438af006527c35bdc07.2Xmz8XG6ZM9n3MXn",
    "zhipu_free_models": ["glm-4-flash", "glm-4-flashx", "glm-4-air"],
    "arxiv_paper_reader": "https://arxiv.org/abs/2301.00001v1"
  },
  "mongodb_connection": {
    "connection_string": "mongodb+srv://root:<ttTT23772377>@cluster0.p3qi0gw.mongodb.net/?appName=Cluster0",
    "note": "这��MongoDB Atlas连接字符串，请勿直接硬编码到代码中！使用.env环境变量存储。",
    "env_var_name": "MONGODB_URI",
    "cluster": "cluster0.p3qi0gw.mongodb.net",
    "security_warning": "⚠️ 重要：连接字符串包含敏感信息，请勿提交到Git仓库！将此字符串添加到.env.local（本地开发）或生产环境变量中。"
  },
  "tasks": [
    {
      "id": "task-001",
      "category": "backend",
      "priority": 1,
      "title": "Git仓库初始化",
      "description": "初始化Git仓库，创建.gitignore文件，设置项目版本控制基础。",
      "status": "pending",
      "verification_steps": [
        "Git仓库已初始化",
        ".gitignore文件已创建（包含Python虚拟环境、node_modules、.env等）",
        "首次提交已创建（'chore: initialize project structure'）"
      ],
      "files_to_create": [
        "D:/ai/fullstack-merged/.gitignore"
      ],
      "dependencies": []
    },
    {
      "id": "task-002",
      "category": "backend",
      "priority": 1,
      "title": "后端环境设置",
      "description": "创建Python虚拟环境，配置Flask应用基础结构。",
      "status": "pending",
      "verification_steps": [
        "Python虚拟环境已创建（backend/venv）",
        "requirements.txt已创建并安装依赖",
        "基础Flask应用结构已创建"
      ],
      "files_to_create": [
        "D:/ai/fullstack-merged/backend/venv/",
        "D:/ai/fullstack-merged/backend/requirements.txt",
        "D:/ai/fullstack-merged/backend/app/__init__.py",
        "D:/ai/fullstack-merged/backend/run.py"
      ],
      "dependencies_to_install": [
        "Flask==3.0.0",
        "Flask-CORS==4.0.0",
        "Flask-JWT-Extended==4.6.0",
        "pymongo==4.6.1",
        "python-dotenv==1.0.0",
        "werkzeug==3.0.1",
        "requests==2.31.0"
      ],
      "dependencies": []
    },
    {
      "id": "task-003",
      "category": "backend",
      "priority": 1,
      "title": "MongoDB配置与连接",
      "description": "配置MongoDB连接，创建数据库模型基础结构。",
      "status": "pending",
      "verification_steps": [
        "MongoDB连接配置已创建",
        ".env.example文件已创建",
        "数据库连接测试通过"
      ],
      "files_to_create": [
        "D:/ai/fullstack-merged/backend/config/__init__.py",
        "D:/ai/fullstack-merged/backend/config/database.py",
        "D:/ai/fullstack-merged/backend/.env.example"
      ],
      "environment_variables": {
        "MONGODB_URI": "mongodb://localhost:27017/scholarai",
        "JWT_SECRET_KEY": "your-secret-key-change-in-production",
        "JWT_ACCESS_TOKEN_EXPIRES": "3600"
      },
      "dependencies": ["task-002"]
    },
    {
      "id": "task-004",
      "category": "backend",
      "priority": 2,
      "title": "用户模型与数据库Schema",
      "description": "创建用户数据模型，定义用户Schema，包括字段：id、email、name、password（哈希）、avatar、role、is_active、stats、created_at、updated_at。",
      "status": "pending",
      "verification_steps": [
        "User模型已创建（backend/models/user.py）",
        "密码哈希函数已实现（使用werkzeug.security）",
        "数据库索引已创建（email唯一索引）"
      ],
      "files_to_create": [
        "D:/ai/fullstack-merged/backend/models/__init__.py",
        "D:/ai/fullstack-merged/backend/models/user.py"
      ],
      "dependencies": ["task-003"]
    },
    {
      "id": "task-005",
      "category": "backend",
      "priority": 2,
      "title": "JWT认证中间件",
      "description": "实现JWT token生成和验证中间件，保护需要认证的API端点。",
      "status": "pending",
      "verification_steps": [
        "JWT生成函数已实现",
        "JWT验证装饰器已实现",
        "当前用户获取函数已实现"
      ],
      "key_functions": [
        "generate_token(user_id)  # 生成JWT token",
        "jwt_required()          # 保护路由的装饰器",
        "get_current_user()        # 从token获取当前用户"
      ],
      "files_to_create": [
        "D:/ai/fullstack-merged/backend/middleware/__init__.py",
        "D:/ai/fullstack-merged/backend/middleware/auth.py"
      ],
      "dependencies": ["task-004"]
    },
    {
      "id": "task-006",
      "category": "backend",
      "priority": 2,
      "title": "认证API端点实现",
      "description": "实现用户注册、登录、获取当前用户信息的API端点。",
      "status": "pending",
      "verification_steps": [
        "POST /api/auth/register - 创建新用户",
        "POST /api/auth/login - 用户登录并返回token",
        "GET /api/auth/me - 验证token并返回用户信息",
        "POST /api/auth/logout - 登出（前端清除token）",
        "使用无效token返回401错误"
      ],
      "api_endpoints": {
        "POST /api/auth/register": {
          "request": "{ name, email, password }",
          "response": "{ success: true, data: { user } }"
        },
        "POST /api/auth/login": {
          "request": "{ email, password }",
          "response": "{ success: true, data: { access_token, token_type, user } }"
        },
        "GET /api/auth/me": {
          "headers": "Authorization: Bearer <token>",
          "response": "{ success: true, data: { user } }"
        }
      },
      "files_to_create": [
        "D:/ai/fullstack-merged/backend/routes/__init__.py",
        "D:/ai/fullstack-merged/backend/routes/auth.py"
      ],
      "dependencies": ["task-005"]
    },
    {
      "id": "task-007",
      "category": "backend",
      "priority": 3,
      "title": "arXiv API集成",
      "description": "集成arXiv免费API，实现论文搜索功能。支持关键词、领域、年份、发表场所过滤和分页。arXiv API文档: https://arxiv.org/help/api/",
      "status": "pending",
      "note": "包括基础论文搜索和元数据获取"
      "verification_steps": [
        "GET /api/papers/search - 论文搜索（arXiv API）",
        "支持关键词搜索（query参数，搜索title、abstract、author）",
        "支持领域过滤（field参数，如cs.AI, cs.CL等）",
        "支持年份范围过滤（year_min, year_max）",
        "支持发表场所过滤（venue参数）",
        "支持分页（page, page_size，默认page_size=10）",
        "返回论文总数和当前页信息",
        "错误处理和重试逻辑"
      ],
      "api_endpoints": {
        "GET /api/papers/search": {
          "query_parameters": "query, field, venue, year_min, year_max, page, page_size",
          "response": "{ success: true, data: { papers: [...], total: 1000, page: 1, page_size: 10 } }"
        }
      },
      "arxiv_api_details": {
        "base_url": "https://export.arxiv.org/api/query",
        "example": "search_query=cat:cs.AI+and+all:deep+learning&date-filter=date-range:2021-01-01+to:2024-12-31"
      },
      "files_to_create": [
        "D:/ai/fullstack-merged/backend/services/__init__.py",
        "D:/ai/fullstack-merged/backend/services/arxiv_client.py",
        "D:/ai/fullstack-merged/backend/routes/papers.py"
      ],
      "key_functions": [
        "async search_papers(query, field=None, year_min=None, year_max=None, venue=None, page=1, page_size=10)",
        "async get_paper_details(paper_id)  # 获取论文详情",
        "async get_paper_pdf_url(paper_id)  # 获取PDF下载链接"
      ],
      "dependencies": ["task-003"]
    },
    {
      "id": "task-007-1",
      "category": "backend",
      "priority": 3,
      "title": "arXiv论文速读API",
      "description": "实现arXiv论文速读功能，深度解析论文。使用arXiv官方论文速读API（例如：https://arxiv.org/abs/2301.00001v1）。如果需要，使用智谱AI的免费模型进行辅助解析。",
      "status": "pending",
      "verification_steps": [
        "GET /api/papers/reader/:paper_id - 获取论文深度解析",
        "支持从arXiv获取论文版本信息",
        "使用智谱AI模型进行论文内容分析（可选）",
        "提取论文关键信息：标题、作者、摘要、关键贡献",
        "返回结构化论文速读数据"
      ],
      "api_endpoints": {
        "GET /api/papers/reader/:paper_id": {
          "response": "{ success: true, data: { paper_id, title, authors, abstract, key_contributions, reading_time, difficulty_level } }"
        }
      },
      "arxiv_api_details": {
        "paper_reader_url": "https://arxiv.org/abs/{paper_id}v1",
        "example": "https://arxiv.org/abs/2301.00001v1"
      },
      "zhipu_ai_integration": {
        "purpose": "使用智谱AI免费模型进行论文深度分析",
        "available_models": ["glm-4-flash", "glm-4-flashx", "glm-4-air"],
        "api_key_note": "已配置用户提供的智谱API Key，可使用免费模型进行测试"
      },
      "files_to_create": [
        "D:/ai/fullstack-merged/backend/services/paper_reader.py",
        "D:/ai/fullstack-merged/backend/routes/paper_reader.py"
      ],
      "key_functions": [
        "async fetch_paper_versions(paper_id)  # 获取arXiv论文所有版本",
        "async parse_paper_with_ai(paper_data, use_zhipu=True)  # 使用AI解析论文",
        "async extract_key_contributions(abstract, full_text)  # 提取关键贡献",
        "async estimate_reading_time(paper_content)  # 估计阅读时间",
        "async assess_difficulty_level(paper_content)  # 评估难度等级"
      ],
      "dependencies": ["task-007", "task-009"]
    },
    {
      "id": "task-008",
      "category": "backend",
      "priority": 4,
      "title": "AI增强搜索",
      "description": "基于arXiv搜索结果，使用智谱AI提供智能增强功能：AI问答、论文对比、自动摘要生成、相关论文推荐。",
      "status": "pending",
      "note": "依赖task-009（智谱AI客户端）和task-007（基础arXiv搜索）",
      "zhipu_ai_note": "使用用户提供的智谱API Key，可免费使用glm-4-flash等模型",
      "verification_steps": [
        "POST /api/papers/ask - AI问答（针对特定论文或搜索结果）",
        "POST /api/papers/compare - 论文对比（最多3篇论文）",
        "POST /api/papers/recommend - 相关论文推荐（基于当前论文）",
        "POST /api/papers/summarize - 批量摘要生成",
        "所有AI功能支持流式输出（SSE）"
      ],
      "api_endpoints": {
        "POST /api/papers/ask": {
          "request": "{ question: string, paper_id?: string, search_context?: { query, filters }, api_config: ApiConfig }",
          "response": "{ success: true, data: { answer } }"
        },
        "POST /api/papers/compare": {
          "request": "{ paper_ids: string[], api_config: ApiConfig }",
          "response": "{ success: true, data: { comparison: string, table: object } }"
        },
        "POST /api/papers/recommend": {
          "request": "{ paper_id: string, count: number, api_config: ApiConfig }",
          "response": "{ success: true, data: { recommendations: Array<{paper_id, title, reason}> } }"
        },
        "POST /api/papers/summarize": {
          "request": "{ paper_ids: string[], api_config: ApiConfig }",
          "response": "{ success: true, data: { summaries: Array<{paper_id, summary}> } }"
        }
      },
      "files_to_create": [
        "D:/ai/fullstack-merged/backend/routes/papers_ai.py"
      ],
      "dependencies": ["task-007", "task-009"]
    },
    {
      "id": "task-009",
      "category": "backend",
      "priority": 4,
      "title": "智谱AI客户端封装",
      "description": "创建智谱AI API客户端，封装知识库API和Agent API的调用逻辑。基于智谱1、2文档实现。",
      "status": "pending",
      "verification_steps": [
        "智谱AI客户端类已实现",
        "Bearer Token认证已实现",
        "错误处理和重试逻辑已实现",
        "支持流式和非流式调用"
      ],
      "key_functions": [
        "async chat_completion(agent_id, messages, stream=False, custom_variables=None)  # Agent API",
        "async upload_document(knowledge_id, file_path, knowledge_type=1, parse_image=False)  # 知识库API",
        "async upload_url_document(knowledge_id, url, knowledge_type=1)  # 知识库API",
        "async get_conversation_history(agent_id, conversation_id)  # Agent API"
      ],
      "api_base_url": "https://open.bigmodel.cn/api/paas/v4",
      "files_to_create": [
        "D:/ai/fullstack-merged/backend/services/zhipu_client.py"
      ],
      "dependencies": ["task-002"]
    },
    {
      "id": "task-010",
      "category": "backend",
      "priority": 4,
      "title": "AI摘要与大纲生成",
      "description": "实现AI摘要生成和研究大纲生成API端点，使用智谱Agent API。",
      "status": "pending",
      "verification_steps": [
        "POST /api/ai/summary - 生成论文摘要",
        "POST /api/ai/outline - 生成研究大纲",
        "支持自定义API配置（api_key, model等）",
        "支持传入论文ID或论文数据"
      ],
      "api_endpoints": {
        "POST /api/ai/summary": {
          "request": "{ paper_id?, paper_data?, api_config }",
          "response": "{ success: true, data: { summary } }"
        },
        "POST /api/ai/outline": {
          "request": "{ paper_id?, paper_data?, api_config }",
          "response": "{ success: true, data: { outline } }"
        }
      },
      "files_to_create": [
        "D:/ai/fullstack-merged/backend/routes/ai.py"
      ],
      "dependencies": ["task-009"]
    },
    {
      "id": "task-011",
      "category": "backend",
      "priority": 4,
      "title": "AI聊天与思维导图",
      "description": "实现AI聊天助手和思维导图生成API，支持流式输出。",
      "status": "pending",
      "verification_steps": [
        "POST /api/ai/chat - AI问答（非流式）",
        "POST /api/ai/chat/stream - AI问答（流式SSE）",
        "POST /api/ai/mindmap - 生成思维导图",
        "支持对话历史上下文",
        "支持特定论文关联问答"
      ],
      "api_endpoints": {
        "POST /api/ai/chat": {
          "request": "{ paper_id?, question, chat_history, api_config }",
          "response": "{ success: true, data: { answer } }"
        },
        "POST /api/ai/chat/stream": {
          "request": "{ paper_id?, question, chat_history, api_config }",
          "response": "text/event-stream (SSE流式输出)"
        },
        "POST /api/ai/mindmap": {
          "request": "{ paper_id?, paper_data?, api_config }",
          "response": "{ success: true, data: { mindmap } }"
        }
      },
      "dependencies": ["task-009"]
    },
    {
      "id": "task-012",
      "category": "backend",
      "priority": 5,
      "title": "项目数据模型",
      "description": "创建项目数据模型，支持研究项目、颜色标识、进度跟踪。",
      "status": "pending",
      "verification_steps": [
        "Project模型已创建",
        "支持字段：id、name、color、description、created_by、papers、progress、created_at、updated_at",
        "数据库索引已创建"
      ],
      "files_to_create": [
        "D:/ai/fullstack-merged/backend/models/project.py"
      ],
      "dependencies": ["task-004"]
    },
    {
      "id": "task-013",
      "category": "backend",
      "priority": 5,
      "title": "项目CRUD API",
      "description": "实现项目的创建、读取、更新、删除API端点。",
      "status": "pending",
      "verification_steps": [
        "GET /api/projects - 获取用户所有项目",
        "POST /api/projects - 创建新项目",
        "GET /api/projects/:id - 获取项目详情",
        "PUT /api/projects/:id - 更新项目",
        "DELETE /api/projects/:id - 删除项目",
        "POST /api/projects/:id/papers - 添加论文到项目"
      ],
      "api_endpoints": {
        "GET /api/projects": {
          "response": "{ success: true, data: { projects: [...] } }"
        },
        "POST /api/projects": {
          "request": "{ name, color, description }",
          "response": "{ success: true, data: { project } }"
        },
        "DELETE /api/projects/:id": {
          "response": "{ success: true }"
        }
      },
      "files_to_create": [
        "D:/ai/fullstack-merged/backend/routes/projects.py"
      ],
      "dependencies": ["task-012"]
    },
    {
      "id": "task-014",
      "category": "backend",
      "priority": 6,
      "title": "收藏夹管理API",
      "description": "实现论文收藏夹功能，支持添加、移除、文件夹管理。",
      "status": "pending",
      "verification_steps": [
        "GET /api/favorites - 获取用户收藏列表",
        "POST /api/favorites/toggle - 切换收藏状态",
        "DELETE /api/favorites/:paper_id - 移除收藏",
        "GET /api/favorites/folders - 获取文件夹列表",
        "POST /api/favorites/folders - 创建文件夹",
        "PUT /api/favorites/folders/:id - 更新文件夹",
        "DELETE /api/favorites/folders/:id - 删除文件夹"
      ],
      "api_endpoints": {
        "GET /api/favorites": {
          "query": "folder_id, sort_by (created_at, title)",
          "response": "{ success: true, data: { favorites: [...] } }"
        },
        "POST /api/favorites/toggle": {
          "request": "{ paper_id, folder_id? }",
          "response": "{ success: true, data: { is_favorited: true } }"
        },
        "POST /api/favorites/folders": {
          "request": "{ name, color }",
          "response": "{ success: true, data: { folder } }"
        }
      },
      "files_to_create": [
        "D:/ai/fullstack-merged/backend/routes/favorites.py"
      ],
      "dependencies": ["task-004", "task-007"]
    },
    {
      "id": "task-015",
      "category": "backend",
      "priority": 6,
      "title": "用户设置与统计API",
      "description": "实现用户设置管理、API配置存储、使用统计数据API。",
      "status": "pending",
      "verification_steps": [
        "GET /api/settings - 获取用户设置",
        "PUT /api/settings - 更新用户设置",
        "GET /api/stats - 获取使用统计",
        "POST /api/settings/api-config - 保存API配置（加密存储）"
      ],
      "api_endpoints": {
        "GET /api/settings": {
          "response": "{ success: true, data: { theme, language, api_config } }"
        },
        "PUT /api/settings": {
          "request": "{ theme?, language?, api_config? }",
          "response": "{ success: true, data: { settings } }"
        },
        "GET /api/stats": {
          "response": "{ success: true, data: { searches_count, favorites_count, papers_analyzed } }"
        }
      },
      "files_to_create": [
        "D:/ai/fullstack-merged/backend/routes/settings.py"
      ],
      "dependencies": ["task-004"]
    },
    {
      "id": "task-016",
      "category": "frontend",
      "priority": 7,
      "title": "替换前端Mock API",
      "description": "将前端所有Mock API调用替换为真实后端API调用。",
      "status": "pending",
      "verification_steps": [
        "authApi.ts已连接后端认证API",
        "aiApi.ts已连接后端AI API",
        "所有页面使用真实API数据",
        "移除mockApi.ts或标记为@deprecated"
      ],
      "files_to_modify": [
        "D:/ai/fullstack-merged/frontend/src/app/services/authApi.ts",
        "D:/ai/fullstack-merged/frontend/src/app/services/aiApi.ts",
        "D:/ai/fullstack-merged/frontend/src/config/api.ts"
      ],
      "dependencies": ["task-006", "task-007", "task-010"]
    },
    {
      "id": "task-017",
      "category": "backend",
      "priority": 7,
      "title": "后端单元测试",
      "description": "编写后端API单元测试，确保覆盖率>=80%。",
      "status": "pending",
      "verification_steps": [
        "pytest已配置",
        "所有模型测试通过",
        "所有路由测试通过",
        "测试覆盖率>=80%"
      ],
      "files_to_create": [
        "D:/ai/fullstack-merged/backend/tests/__init__.py",
        "D:/ai/fullstack-merged/backend/tests/test_auth.py",
        "D:/ai/fullstack-merged/backend/tests/test_papers.py",
        "D:/ai/fullstack-merged/backend/tests/test_ai.py",
        "D:/ai/fullstack-merged/backend/pytest.ini"
      ],
      "dependencies_to_install": [
        "pytest==7.4.3",
        "pytest-cov==4.1.0",
        "pytest-mock==3.12.0"
      ],
      "dependencies": ["task-015"]
    },
    {
      "id": "task-018",
      "category": "testing",
      "priority": 8,
      "title": "E2E测试与部署准备",
      "description": "使用Playwright进行端到端测试，准备生产环境配置。",
      "status": "pending",
      "verification_steps": [
        "E2E测试套件已创建",
        "用户注册→登录→搜索→收藏流程测试通过",
        "AI助手交互测试通过",
        "项目创建和管理测试通过",
        "生产环境配置文件已创建"
      ],
      "e2e_test_scenarios": [
        "用户注册新账户",
        "用户登录并访问仪表板",
        "搜索论文并查看详情",
        "添加论文到收藏夹",
        "创建项目并添加论文",
        "使用AI助手生成摘要",
        "修改用户设置",
        "用户登出"
      ],
      "files_to_create": [
        "D:/ai/fullstack-merged/e2e/tests/login.spec.ts",
        "D:/ai/fullstack-merged/e2e/tests/search.spec.ts",
        "D:/ai/fullstack-merged/e2e/tests/favorites.spec.ts",
        "D:/ai/fullstack-merged/e2e/tests/ai-chat.spec.ts",
        "D:/ai/fullstack-merged/deployment/.env.production"
      ],
      "dependencies": ["task-016", "task-017"]
    }
  ]
}
